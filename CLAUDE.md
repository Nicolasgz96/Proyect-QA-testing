# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a QA test case management system for the Hello Britannica application. The project manages Excel-based test cases with Python automation scripts for analysis, formatting restoration, and verification.

## Development Setup

### Prerequisites
```bash
# Install Python 3 and dependencies
sudo apt install python3 python3-pip python3-venv

# Install required packages
pip3 install -r requirements.txt
```

### Running Scripts
All scripts must be run from the project root directory:

```bash
# Analysis
python3 scripts/analysis/analyze_excel.py
python3 scripts/analysis/add_test_cases.py

# Verification
python3 scripts/verification/verify_test_cases.py
python3 scripts/verification/detailed_verification.py

# Formatting
python3 scripts/formatting/restore_formatting.py
python3 scripts/formatting/verify_formatting.py
python3 scripts/formatting/formatting_summary.py
```

## Architecture

### Path Resolution System
**Critical**: All scripts use a centralized path resolution system via `scripts/common/excel_utils.py`. This module provides dynamic path resolution relative to the project root.

**Key functions**:
- `get_project_root()` - Resolves to project root from `scripts/common/`
- `get_excel_path()` - Returns path to main Excel file in `test_cases/current/`
- `get_backup_path()` - Returns path to backup files in `test_cases/backups/`
- `get_data_path()` - Returns path to data files in `data/`
- `get_docs_path()` - Returns path to documentation in `documentation/reports/`

**Why this matters**: The project was refactored to eliminate hardcoded Windows paths. All new scripts MUST use these utility functions for path resolution, not hardcoded paths or manual path construction.

### Script Categories

**Analysis scripts** (`scripts/analysis/`):
- Parse and analyze Excel test case files
- Add test cases from markdown format to Excel
- Generate JSON analysis reports to `data/`

**Formatting scripts** (`scripts/formatting/`):
- Restore original Excel formatting while preserving content
- Use `openpyxl` to copy cell styles, borders, fonts, fills, alignments
- Compare original vs modified workbooks

**Verification scripts** (`scripts/verification/`):
- Verify test cases were added correctly
- Check specific test IDs exist in expected sheets
- Generate verification statistics

### Common Utilities Pattern
All scripts follow this pattern:

```python
#!/usr/bin/env python3
import sys
from pathlib import Path

# Add parent to path for imports
sys.path.insert(0, str(Path(__file__).parent.parent))

from common.excel_utils import (
    load_excel_safely,
    save_excel_safely,
    get_excel_path,
    print_section_header
)

def main():
    file_path = get_excel_path()  # NOT hardcoded
    wb = load_excel_safely(file_path)  # With error handling
    # ... work ...
    save_excel_safely(wb, file_path)  # Safe save

if __name__ == "__main__":
    main()
```

### Error Handling Convention
All scripts use consistent error handling:
- Print errors to `sys.stderr`
- Return exit code 1 on failure, 0 on success
- Check file existence before processing
- Provide clear, actionable error messages
- Include stack traces in debug mode

Example:
```python
try:
    wb = load_excel_safely(file_path)
except FileNotFoundError:
    print(f"Error: File not found at {file_path}", file=sys.stderr)
    sys.exit(1)
except Exception as e:
    print(f"Error: {e}", file=sys.stderr)
    import traceback
    traceback.print_exc()
    sys.exit(1)
```

## File Organization

**Main Excel file**: `test_cases/current/Hello Master test cases.xlsx`
- This is the working copy
- Contains multiple sheets: Admin Onboard, Teacher - Email, Security Testing, Negative Scenarios

**Backup files**: `test_cases/backups/`
- `Hello Master test cases - ORIGINAL.xlsx` - Original unmodified version
- `Hello Master test cases_BACKUP.xlsx` - Pre-modification backup

**Markdown test case input**: `documentation/reports/New_Test_Cases_To_Add.md`
- Used by `add_test_cases.py` to add new test cases
- Parsed format: sections with tables containing test IDs, titles, steps, etc.

**Analysis output**: `data/excel_analysis.json`
- Generated by `analyze_excel.py`
- Contains sheet structure, dimensions, test case counts

## Adding New Scripts

When creating new scripts:

1. **Use the common utilities** - Import from `scripts/common/excel_utils.py`
2. **Follow the naming convention** - `verb_noun.py` (e.g., `verify_test_cases.py`)
3. **Place in correct category** - analysis/, formatting/, or verification/
4. **Add to scripts/README.md** - Document the new script
5. **Use type hints** - Include parameter and return types
6. **Handle errors properly** - Use try/except with stderr output
7. **Return exit codes** - 0 for success, 1 for failure

Template for new scripts:
```python
#!/usr/bin/env python3
"""
Script description here
"""
import sys
from pathlib import Path

sys.path.insert(0, str(Path(__file__).parent.parent))

from common.excel_utils import (
    load_excel_safely,
    get_excel_path,
    print_section_header
)


def your_function(file_path: Path) -> bool:
    """
    Function description.

    Args:
        file_path: Path to Excel file

    Returns:
        True if successful, False otherwise
    """
    try:
        wb = load_excel_safely(file_path)
        # Your logic here
        wb.close()
        return True
    except Exception as e:
        print(f"Error: {e}", file=sys.stderr)
        return False


def main():
    """Main entry point."""
    print_section_header("Your Script Title")

    file_path = get_excel_path()

    if not file_path.exists():
        print(f"Error: File not found", file=sys.stderr)
        sys.exit(1)

    success = your_function(file_path)

    if not success:
        sys.exit(1)


if __name__ == "__main__":
    main()
```

## Excel File Structure

The main Excel file has these sheets:
- **Admin Onboard** - Admin and teacher onboarding test cases
- **Teacher - Email** - Teacher email functionality tests
- **Security Testing** - Security-related test cases
- **Negative Scenarios** - Negative test scenarios

Each sheet has these columns:
1. `#` - Test case ID (e.g., AO001, TE001, SEC001, NEG001)
2. `Module` - Module name
3. `Tittle` - Test case title (note: typo exists in actual header)
4. `Pre-Conditioin` - Prerequisites (note: typo exists)
5. `Steps to folow` - Test steps (note: typo exists)
6. `Expected results` - Expected outcomes
7. `Pass/Failed` - Test execution result
8. `Notes` - Additional notes

**Important**: When working with Excel headers, use the exact spelling as it appears (including typos) for compatibility.

## Formatting Operations

When restoring Excel formatting:
- Copy styles from original workbook to result workbook
- Preserve content from modified workbook
- Copy: fonts, fills, borders, alignments, number formats, column widths, row heights, merged cells, freeze panes, tab colors
- For new rows beyond original range, apply formatting from template row (usually row 2)
- Save to temporary file first, then verify before replacing

## Test Case ID Patterns

Test IDs follow these prefixes:
- `AO###` - Admin Onboard
- `TE###` - Teacher Email
- `SEC###` - Security Testing
- `NEG###` - Negative Scenarios

When adding test cases, maintain sequential numbering within each category.

## Git Configuration

Repository is configured for:
- User: nico- (or Nicolasgz96)
- Email: 96.nicolasgonzalez@gmail.com
- Remote: https://github.com/Nicolasgz96/Proyect-QA-testing.git
- Branch: main

## Important Constraints

1. **Never use hardcoded absolute paths** - Always use `excel_utils` functions
2. **Excel files must be closed** - Scripts will fail if files are open in Excel
3. **Run from project root** - Scripts expect `os.getcwd()` to be project root
4. **Preserve backups** - Never modify files in `test_cases/backups/`
5. **Python 3 only** - All shebangs use `#!/usr/bin/env python3`
6. **openpyxl dependency** - Required for all Excel operations

## Testing Scripts

Before committing script changes:
```bash
# Test path resolution
python3 scripts/analysis/analyze_excel.py

# Test error handling (temporarily rename file)
mv "test_cases/current/Hello Master test cases.xlsx" "test_cases/current/backup.xlsx"
python3 scripts/analysis/analyze_excel.py  # Should show clear error
mv "test_cases/current/backup.xlsx" "test_cases/current/Hello Master test cases.xlsx"

# Test all verification scripts
python3 scripts/verification/verify_test_cases.py
python3 scripts/verification/detailed_verification.py
```

## Recent Refactoring

The codebase was recently refactored to fix:
1. Hardcoded Windows paths (removed all `/mnt/c/Users/...` paths)
2. Inconsistent shebangs (standardized to `python3`)
3. Missing dependency management (added `requirements.txt`)
4. Poor error handling (added comprehensive try/except blocks)
5. Code duplication (created `scripts/common/excel_utils.py`)

When reviewing old commits or issues, be aware that the architecture has significantly changed from the original flat structure with hardcoded paths to the current organized, portable structure.
